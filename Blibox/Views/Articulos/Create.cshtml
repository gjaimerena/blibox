
@model Blibox.Articulo


<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            @ViewBag.Message
        </h1>
        <ol class="breadcrumb">
            <li><a href="@Url.Action("Index", "Articulos")"><i class="fa fa-dashboard"></i> Articulos</a></li>
            <li class="active">Nuevo Articulo</li>
        </ol>
    </section>
    <!-- Main content -->
    <section class="content">


        @using (Html.BeginForm())
        {
            @Html.AntiForgeryToken()

        <!-- SELECT2 EXAMPLE -->
            <div class="box box-default">
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                <div class="box-header with-border">
                    <h3 class="box-title">Nuevo Articulo</h3>
                </div><!-- /.box-header -->
                <div class="box-body">
                    <div class="row">
                       @* <div class="col-md-3">
                            <div class="form-group">
                                <label>ID Articulo</label>
                                <div>
                                    @Html.EditorFor(model => model.ID_articulo, new { htmlAttributes = new { @class = "form-control", @disabled = "disabled" } })
                                    @Html.ValidationMessageFor(model => model.ID_articulo, "", new { @class = "text-danger" })
                                </div>
                            </div><!-- /.form-group -->
                        </div>*@

                        <div class="col-md-3">
                            <div class="form-group">
                                <label>ID Cliente</label>
                                <div>
                                    @Html.DropDownList("ID_cliente", null, htmlAttributes: new { @class = "form-control" })
                                    @Html.ValidationMessageFor(model => model.ID_cliente, "", new { @class = "text-danger" })
                                </div>
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->

                        <div class="col-md-3">
                            <div class="form-group">
                                <label>F0PD</label>
                                @Html.EditorFor(model => model.ID_articulo, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.ID_articulo, "", new { @class = "text-danger" })
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->
                    </div>
                    <div class="row">
                        <div class="col-md-9">
                            <div class="form-group">
                                <label>Descripción</label>
                                <div>
                                    @Html.EditorFor(model => model.Descripcion, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.Descripcion, "", new { @class = "text-danger" })
                                </div>
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->
                    </div><!-- /.row -->

                    <div class="row">
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Precio Costo</label>
                                <div>
                                    @Html.EditorFor(model => model.Costo, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.Costo, "", new { @class = "text-danger" })
                                </div>
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Precio Lista</label>
                                <div>
                                    @Html.EditorFor(model => model.Precio_lista, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.Precio_lista, "", new { @class = "text-danger" })
                                </div>
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->

                        <div class="col-md-2">

                            <div class="form-group">
                                <label>Fecha Precio Lista:</label>
                                <div class="input-group">
                                    <div class="input-group-addon">
                                        <i class="fa fa-calendar"></i>
                                    </div>
                                    @Html.EditorFor(model => model.Precio_fecha, new { htmlAttributes = new { @class = "form-control  pull-right", id = "reservation" } })
                                    @Html.ValidationMessageFor(model => model.Precio_fecha, "", new { @class = "text-danger" })
                                </div><!-- /.input group -->
                            </div><!-- /.form group -->
                        </div><!-- /.col -->
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>IVA</label>
                                <div>
                                    @Html.RadioButtonFor(model => model.IVA, "SI") SI
                                    @Html.RadioButtonFor(model => model.IVA, "NO") NO
                                </div>
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->
                    </div><!-- /.row -->

                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Stock</label>
                                <div>
                                    @Html.EditorFor(model => model.Stock, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.Stock, "", new { @class = "text-danger" })
                                </div>
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Stock Minimo</label>
                                <div>
                                    @Html.EditorFor(model => model.Stock_minimo, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.Stock_minimo, "", new { @class = "text-danger" })
                                </div>
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->

                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Fazon</label>
                                <div>
                                    @Html.RadioButtonFor(model => model.Fazon, "SI") SI
                                    @Html.RadioButtonFor(model => model.Fazon, "NO") NO
                                    @Html.ValidationMessageFor(model => model.Fazon, "", new { @class = "text-danger" })
                                </div>
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->
                    </div><!-- /.row -->
                    <div class="row">
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Cantidad por bulto</label>
                                <div>
                                    @Html.EditorFor(model => model.Cant_x_bulto, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.Cant_x_bulto, "", new { @class = "text-danger" })
                                </div>
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Tamaño Caja</label>
                                <div>
                                    @Html.EditorFor(model => model.Tamaño_caja, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.Tamaño_caja, "", new { @class = "text-danger" })
                                </div>
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Tiraje Term. por Hora</label>
                                <div>
                                    @Html.EditorFor(model => model.Tiraje_term_x_hora, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.Tiraje_term_x_hora, "", new { @class = "text-danger" })
                                </div>
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Tiraje troquel por hora</label>
                                <div>
                                    @Html.EditorFor(model => model.Tiraje_troquel_x_hora, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.Tiraje_troquel_x_hora, "", new { @class = "text-danger" })
                                </div>
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->
                    </div><!-- /.row -->
                    <div class="row">
                        <div class="col-md-9">
                            <div class="form-group">
                                <label>Observaciones</label>
                                <div>
                                    @Html.EditorFor(model => model.Observaciones, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.Observaciones, "", new { @class = "text-danger" })
                                </div>
                            </div><!-- /.form-group -->
                        </div><!-- /.col -->

                    </div><!-- /.row -->
                   

                    <div>
                        <em data-bind="validationMessage: detalle"></em>
                    </div>

                    <button data-bind="click: agregarDetalle">Agregar Componente</button>

                    <br /><br />

                    <div class="box box-default" data-bind="foreach: detalle">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label>Material</label>
                                        <div>
                                            <select required="required" data-bind="value: ID_material, options: window.materiales, optionsText: 'Descripcion', optionsValue: 'ID_material', attr: { name: 'Componente[' + $index() + '].ID_material' }"></select>
                                            <em data-bind="validationMessage: ID_material"></em>

                                        </div>
                                    </div><!-- /.form-group -->
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label>Ciclos</label>
                                        <div>
                                            <input type="number" required="required" min="0" max="999999999" data-bind="value: Ciclos, attr: { name: 'Componente[' + $index() + '].Ciclos' }" />
                                            <em data-bind="validationMessage: Ciclos"></em>

                                        </div>
                                    </div><!-- /.form-group -->
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label>Bocas</label>
                                        <div>
                                            <input type="number" required="required" min="0" max="999999999" data-bind="value: Bocas, attr: { name: 'Componente[' + $index() + '].Bocas' }" />
                                            <em data-bind="validationMessage: Bocas"></em>
                                        </div>
                                    </div><!-- /.form-group -->
                                </div>
                            
                       

                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label>Espesor</label>
                                        <div>
                                            <input type="number" required="required" min="0" max="999999999" data-bind="value: Espesor, attr: { name: 'Componente[' + $index() + '].Espesor' }" />
                                            <em data-bind="validationMessage: Espesor"></em>
                                        </div>
                                    </div><!-- /.form-group -->
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label>Color</label>
                                        <div>
                                            <input type="number" required="required" min="0" max="999999999" data-bind="value: Color, attr: { name: 'Componente[' + $index() + '].Color' }" />
                                            <em data-bind="validationMessage: Color"></em>
                                        </div>
                                    </div><!-- /.form-group -->
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label>Peso</label>
                                        <div>
                                            <input type="number" required="required" min="0" max="999999999" data-bind="value: Peso, attr: { name: 'Componente[' + $index() + '].Peso' }" />
                                            <em data-bind="validationMessage: Peso"></em>
                                        </div>
                                    </div><!-- /.form-group -->
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Marco</label>
                                        <div>

                                            <select required="required" data-bind="value: ID_marco, options: window.marcos, optionsText: 'Descripcion', optionsValue: 'ID_marco', attr: { name: 'Componente[' + $index() + '].ID_marco' }"></select>
                                            <em data-bind="validationMessage: ID_marco"></em>
                                        </div>
                                    </div><!-- /.form-group -->
                                </div><!-- /.col -->



                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Matriz</label>
                                        <div>
                                            <select required="required" data-bind="value: ID_matriz, options: window.matriz, optionsText: 'Codigo', optionsValue: 'ID_matriz', attr: { name: 'Componente[' + $index() + '].ID_matriz' }"></select>
                                            <em data-bind="validationMessage: ID_matriz"></em>
                                        </div>
                                    </div><!-- /.form-group -->
                                </div><!-- /.col -->

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Cortante</label>
                                        <div>
                                            <select required="required" data-bind="value: ID_cortante, options: window.cortante, optionsText: 'Descripcion', optionsValue: 'ID_cortante', attr: { name: 'Componente[' + $index() + '].ID_cortante' }"></select>
                                            <em data-bind="validationMessage: ID_cortante"></em>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <button data-bind="click: $root.eliminarDetalle">Eliminar</button>
                            </div>
                           
                           
                        </div>
                        <hr style="background-color: red; height: 1px; border: 0;"/>
                    </div>

                        @*<table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Material</th>
                                    <th>Ciclos</th>
                                    <th>Bocas</th>
                                    <th>Espesor</th>
                                    <th>Color</th>
                                    <th>Peso</th>
                                    <th>Marco</th>
                                    <th>Matriz</th>
                                    <th>Cortante</th>

                                </tr>
                            </thead>
                            <tbody data-bind="foreach: detalle">
                                <tr>
                                    <td>
                                        <select required="required" data-bind="value: ID_material, options: window.materiales, optionsText: 'Descripcion', optionsValue: 'ID_material', attr: { name: 'Componente[' + $index() + '].ID_material' }"></select>
                                        <em data-bind="validationMessage: ID_material"></em>
                                    </td>
                                    <td>
                                        <input type="number" required="required" min="0" max="999999999" data-bind="value: Ciclos, attr: { name: 'Componente[' + $index() + '].Ciclos' }" />
                                        <em data-bind="validationMessage: Ciclos"></em>
                                    </td>
                                    <td>
                                        <input type="number" required="required" min="0" max="999999999" data-bind="value: Bocas, attr: { name: 'Componente[' + $index() + '].Bocas' }" />
                                        <em data-bind="validationMessage: Bocas"></em>
                                    </td>
                                    <td>
                                        <input type="number" required="required" min="0" max="999999999" data-bind="value: Espesor, attr: { name: 'Componente[' + $index() + '].Espesor' }" />
                                        <em data-bind="validationMessage: Espesor"></em>
                                    </td>
                                    <td>
                                        <input type="number" required="required" min="0" max="999999999" data-bind="value: Color, attr: { name: 'Componente[' + $index() + '].Color' }" />
                                        <em data-bind="validationMessage: Color"></em>
                                    </td>
                                    <td>
                                        <input type="number" required="required" min="0" max="999999999" data-bind="value: Peso, attr: { name: 'Componente[' + $index() + '].Peso' }" />
                                        <em data-bind="validationMessage: Peso"></em>
                                    </td>
                                    <td>
                                        <select required="required" data-bind="value: ID_marco, options: window.marcos, optionsText: 'Descripcion', optionsValue: 'ID_marco', attr: { name: 'Componente[' + $index() + '].ID_marco' }"></select>
                                        <em data-bind="validationMessage: ID_material"></em>
                                    </td>

                                    <td>
                                        <select required="required" data-bind="value: ID_matriz, options: window.matriz, optionsText: 'Codigo', optionsValue: 'ID_matriz', attr: { name: 'Componente[' + $index() + '].ID_matriz' }"></select>
                                        <em data-bind="validationMessage: ID_matriz"></em>
                                    </td>
                                    <td>
                                        <select required="required" data-bind="value: ID_cortante, options: window.cortante, optionsText: 'Descripcion', optionsValue: 'ID_cortante', attr: { name: 'Componente[' + $index() + '].ID_cortante' }"></select>
                                        <em data-bind="validationMessage: ID_cortante"></em>
                                    </td>
                                    <td>
                                        <button data-bind="click: $root.eliminarDetalle">Eliminar</button>
                                    </td>
                                </tr>
                            </tbody>

                        </table>*@

                        <br />

                        <div class="form-group">
                            <div class="box-footer">
                                <input type="submit" value="Generar" data-bind="enable: canCreate()" class="btn btn-primary" />
                            </div>

                        </div>
                    </div><!-- /.box-body -->

            </div><!-- /.box -->

        }

        <div>
            <button type="button" class="btn btn-info ">@Html.ActionLink("Volver", "Index")</button>
        </div>



    </section>
</div><!-- /.content-wrapper -->

<script src="~/Scripts/ArticuloCreateViewModel.js"></script>
<script src="~/Scripts/knockout-3.4.0.js"></script>
<script src="~/Scripts/knockout.validation.js"></script>

<script>
    // catálogo de productos que se utiliza para llenar el <select /> de productos de cada detalle
    var materiales = JSON.parse('@Html.Raw(Json.Encode(ViewBag.Mat_Descripcion))');

    // catálogo de productos que se utiliza para llenar el <select /> de productos de cada detalle
    var marcos = JSON.parse('@Html.Raw(Json.Encode(ViewBag.Marco))');

    var matriz = JSON.parse('@Html.Raw(Json.Encode(ViewBag.Matriz))');

    var cortante = JSON.parse('@Html.Raw(Json.Encode(ViewBag.cortante))');


    // viewModel con el que haremos el binding de nuestra vista.
    var viewModel = new articuloViewModel();

    // inicializamos la validación de knockout.
    ko.validation.init({ insertMessages: false, parseInputAttributes: true });

    // aplicamos el viewModel a nuestra vista.
    ko.applyBindings(viewModel);

</script>